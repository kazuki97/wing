<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- 既存のメタタグやスタイルシート -->
  <meta charset="UTF-8" />
  <script src="alertOverride.js"></script>
  <title>ビジネス管理システム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- エラーメッセージ表示エリア -->
  <div id="error-message" class="error-message"></div>
  <div id="message" class="message" style="display: none;"></div>

  <!-- ナビゲーションメニュー -->
  <nav>
    <!-- ハンバーガーメニューアイコンを追加 -->
    <div class="menu-icon" id="menuIcon">&#9776;</div>
    <ul id="navMenu">
      <li><a href="#home" class="nav-link">ホーム</a></li>
      <li><a href="#categories" class="nav-link">カテゴリ設定</a></li>
      <li><a href="#products" class="nav-link">商品設定</a></li>
      <li><a href="#inventory" class="nav-link">在庫管理</a></li>
      <li><a href="#overall-inventory" class="nav-link">全体在庫</a></li>
      <li><a href="#barcode" class="nav-link">バーコードスキャン</a></li>
      <li><a href="#transactions" class="nav-link">売上管理</a></li>
      <li><a href="#pricing" class="nav-link">単価設定</a></li>
      <li><a href="#payment-methods" class="nav-link">支払い方法設定</a></li>
      <li><a href="#sales-analysis" class="nav-link">売上分析</a></li>
      <li><a href="#consumables" class="nav-link">消耗品管理</a></li>
      <!-- ログアウトボタンを追加 -->
      <li><a href="#" onclick="logout(); return false;">ログアウト</a></li>
    </ul>
  </nav>

  <!-- ログインフォームを修正 -->
  <div id="loginForm" style="display: none;">
    <form id="loginFormElement">
      <input type="email" id="email" placeholder="メールアドレスを入力" required />
      <input type="password" id="password" placeholder="パスワードを入力" required />
      <button type="submit">ログイン</button>
    </form>
  </div>

  <!-- 各セクションのコンテナ -->
  <main>
    <!-- ホーム -->
    <section id="home" class="content-section">
      <h1>ホーム</h1>
    </section>

    <!-- カテゴリ設定セクション -->
    <section id="categories" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>カテゴリ設定</h1>

      <!-- モーダルを開くためのボタン -->
      <button id="openAddParentCategoryModal">親カテゴリを追加</button>
      <button id="openAddSubcategoryModal">サブカテゴリを追加</button>

      <!-- カテゴリ一覧表示エリア -->
      <div id="categoryList">
        <ul id="parentCategoryList"></ul>
      </div>
    </section>

    <!-- 親カテゴリ追加用モーダル -->
    <div id="addParentCategoryModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeParentCategoryModal">&times;</span>
        <h2>親カテゴリの追加</h2>
        <form id="modalAddParentCategoryForm">
          <input type="text" id="modalParentCategoryName" placeholder="親カテゴリ名" required />
          <button type="submit">追加</button>
        </form>
      </div>
    </div>

    <!-- サブカテゴリ追加用モーダル -->
    <div id="addSubcategoryModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeSubcategoryModal">&times;</span>
        <h2>サブカテゴリの追加</h2>
        <form id="modalAddSubcategoryForm">
          <select id="modalSubcategoryParentCategorySelect" required></select>
          <input type="text" id="modalSubcategoryName" placeholder="サブカテゴリ名" required />
          <button type="submit">追加</button>
        </form>
      </div>
    </div>

    <!-- 商品設定 -->
    <section id="products" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>商品設定</h1>

      <!-- 商品追加モーダルを開くボタン -->
      <button id="openAddProductModal">商品を追加</button>

      <!-- 商品フィルタリング -->
      <div>
        <select id="filterParentCategorySelect">
          <option value="">すべての親カテゴリ</option>
        </select>
        <select id="filterSubcategorySelect">
          <option value="">すべてのサブカテゴリ</option>
        </select>
      </div>

      <!-- 商品一覧表示エリア -->
      <ul id="productList"></ul>
    </section>

    <!-- 商品追加用モーダル -->
    <div id="addProductModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeAddProductModal">&times;</span>
        <h2>商品追加</h2>
        <!-- 商品追加フォーム -->
        <form id="addProductForm">
          <select id="productParentCategorySelect" required></select>
          <select id="productSubcategorySelect" required></select>
          <input type="text" id="productName" placeholder="商品名" required />
          <input type="number" id="productPrice" placeholder="価格" required />
          <input type="number" id="productCost" placeholder="原価" required />
          <input type="text" id="productBarcode" placeholder="バーコード" />
          <input type="number" id="productQuantity" placeholder="数量" required />
          <input type="number" id="productSize" placeholder="サイズ" required />

          <!-- 消耗品選択リストを追加 -->
          <div id="consumablesSelection">
            <label>使用する消耗品:</label>
            <div id="consumableCheckboxes">
              <!-- JavaScriptで消耗品チェックボックスを動的に追加 -->
            </div>
          </div>

          <button type="submit">追加</button>
        </form>
      </div>
    </div>

    <!-- 商品編集フォーム（変更なし） -->
    <div id="editProductFormContainer" style="display: none;">
      <!-- 編集フォームの内容 -->
    </div>

   <!-- 在庫管理 -->
<section id="inventory" class="content-section" style="display: none;" data-requires-auth="true">
  <h1>在庫管理</h1>
  <!-- カテゴリフィルタリング -->
  <div>
    <select id="inventoryParentCategorySelect" required>
      <option value="">親カテゴリを選択</option>
    </select>
    <select id="inventorySubcategorySelect" required>
      <option value="">サブカテゴリを選択</option>
    </select>
  </div>
  <!-- 商品一覧表示エリア -->
  <div class="table-responsive">
    <table id="inventoryList">
      <thead>
        <tr>
          <th>商品名</th>
          <th>数量</th>
          <th>価格</th>
          <th>原価</th>
          <th>バーコード</th>
          <th>サイズ</th>
          <th>操作</th>
          <th>変動履歴</th> <!-- ここを追加 -->
        </tr>
      </thead>
      <tbody>
        <!-- 商品情報がここに表示されます -->
      </tbody>
    </table>
  </div>
</section>


    <!-- 全体在庫 -->
<section id="overall-inventory" class="content-section" style="display: none;" data-requires-auth="true">
  <h1>全体在庫</h1>
  <!-- 全体在庫更新フォーム -->
  <form id="updateOverallInventoryForm">
    <select id="overallInventoryParentCategorySelect" required>
      <option value="">親カテゴリを選択</option>
    </select>
    <select id="overallInventorySubcategorySelect" required>
      <option value="">サブカテゴリを選択</option>
    </select>
    <input type="number" id="overallInventoryQuantity" placeholder="在庫数" required />
    <!-- **理由入力フィールドを追加** -->
    <input type="text" id="overallInventoryReason" placeholder="理由を入力" />
    <button type="submit">更新</button>
  </form>
  <!-- 全体在庫一覧表示エリア -->
  <div class="table-responsive">
    <table id="overallInventoryList">
      <thead>
        <tr>
          <th>サブカテゴリ名</th>
          <th>在庫数</th>
          <!-- **「変動履歴」列を追加** -->
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <!-- 全体在庫情報がここに表示されます -->
      </tbody>
    </table>
  </div>
</section>

<!-- **全体在庫変動履歴表示用モーダルを追加** -->
<div id="overallInventoryHistoryModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeOverallInventoryHistoryModal">&times;</span>
    <h2>全体在庫変動履歴</h2>
    <table id="overallInventoryHistoryTable">
      <thead>
        <tr>
          <th>日時</th>
          <th>変動数</th>
          <th>変更後の数量</th>
          <th>操作したユーザー</th>
          <th>理由</th>
        </tr>
      </thead>
      <tbody>
        <!-- 履歴データがここに表示されます -->
      </tbody>
    </table>
  </div>
</div>

    <!-- バーコードスキャン -->
    <section id="barcode" class="content-section" style="display: none;">
      <h1>バーコードスキャン</h1>

      <!-- バーコードスキャン開始ボタンを追加 -->
      <button id="startBarcodeScanButton">バーコードスキャンを開始</button>

      <!-- バーコードスキャン用ビデオフィード -->
      <div id="barcode-scanner" style="width: 100%; height: 300px;"></div>

      <!-- 手動でバーコードを入力するための入力フィールドと追加ボタン -->
      <div id="barcodeScanner">
        <input type="text" id="barcodeInput" placeholder="バーコードをスキャンまたは入力" autofocus />
        <button id="addBarcodeButton">追加</button>
      </div>

      <!-- 支払い方法の選択 -->
      <div id="paymentMethodSelection">
        <label for="paymentMethodSelect">支払い方法:</label>
        <select id="paymentMethodSelect" required>
          <!-- 支払い方法がここに表示されます -->
        </select>
      </div>
      <!-- 販売カート -->
      <div class="table-responsive">
        <table id="salesCart">
          <thead>
            <tr>
              <th>商品名</th>
              <th>数量</th>
              <th>単価</th>
              <th>小計</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- カート内の商品がここに表示されます -->
          </tbody>
        </table>
      </div>
      <!-- 合計金額表示と販売完了ボタン -->
      <div id="totalAmount">合計金額: ¥0</div>
      <button id="completeSaleButton">販売完了</button>
    </section>

    <!-- 売上管理 -->
    <section id="transactions" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>売上管理</h1>
      <!-- フィルタリングフォーム -->
      <form id="filterTransactionsForm">
        <label for="filterYear">年:</label>
        <input type="number" id="filterYear" min="2000" max="2100" />
        <label for="filterMonth">月:</label>
        <input type="number" id="filterMonth" min="1" max="12" />
        <label for="filterOnlyReturned">返品のみ:</label>
        <input type="checkbox" id="filterOnlyReturned" />
        <button type="submit">フィルタ</button>
      </form>
      <!-- 手動で売上を追加するボタン -->
      <button id="manualAddTransactionButton">手動で売上を追加</button>
      <!-- 手動で売上を追加するフォーム -->
      <div id="manualAddTransactionForm" style="display: none;">
        <h2>売上の手動追加</h2>
        <form id="addTransactionForm">
          <label for="transactionProductName">商品名:</label>
          <input type="text" id="transactionProductName" placeholder="商品名を入力" required />

          <label for="transactionProductPrice">単価:</label>
          <input type="number" id="transactionProductPrice" placeholder="単価" required />

          <label for="transactionProductQuantity">数量:</label>
          <input type="number" id="transactionProductQuantity" placeholder="数量" required />

          <label for="transactionProductCost">原価:</label>
          <input type="number" id="transactionProductCost" placeholder="原価" required />

          <label for="transactionPaymentMethod">支払い方法:</label>
          <select id="transactionPaymentMethod" required>
            <!-- 支払い方法がここに表示されます -->
          </select>

          <label for="transactionSize">サイズ:</label>
          <input type="number" id="transactionSize" name="transactionSize" min="1" required />

          <button type="submit">追加</button>
          <button type="button" id="cancelAddTransaction">キャンセル</button>
        </form>
      </div>
      <!-- 取引の編集フォーム -->
      <div id="editTransactionFormContainer" style="display: none;">
        <h2>取引編集</h2>
        <form id="editTransactionForm">
          <input type="hidden" id="editTransactionId" />
          <label for="editTransactionTimestamp">日時:</label>
          <input type="datetime-local" id="editTransactionTimestamp" required />

          <label for="editTransactionProductName">商品名:</label>
          <input type="text" id="editTransactionProductName" required />

          <label for="editTransactionQuantity">数量:</label>
          <input type="number" id="editTransactionQuantity" required />

          <label for="editTransactionUnitPrice">販売価格:</label>
          <input type="number" id="editTransactionUnitPrice" required />

          <label for="editTransactionCost">原価:</label>
          <input type="number" id="editTransactionCost" name="cost" required />

          <label for="editTransactionPaymentMethod">支払い方法:</label>
          <select id="editTransactionPaymentMethod" required>
            <!-- 支払い方法の選択肢がここに追加されます -->
          </select>

          <label for="editTransactionSize">サイズ:</label>
          <input type="number" id="editTransactionSize" name="editTransactionSize" min="1" required />

          <button type="submit">更新</button>
          <button type="button" id="cancelEditTransaction">キャンセル</button>
        </form>
      </div>
      <!-- 売上データの表示エリア -->
      <div class="table-responsive">
        <table id="transactionList">
          <thead>
            <tr>
              <th>取引ID</th>
              <th>日時</th>
              <th>支払い方法</th>
              <th>商品名</th>
              <th>個数</th>
              <th>売上金額</th>
              <th>手数料</th>
              <th>原価</th>
              <th>利益</th>
              <th>詳細</th>
            </tr>
          </thead>
          <tbody>
            <!-- 売上データがここに表示されます -->
          </tbody>
        </table>
      </div>
      <!-- 取引の詳細表示エリア -->
      <div id="transactionDetails" style="display: none;">
        <h2>取引詳細</h2>
        <p>取引ID: <span id="detailTransactionId"></span></p>
        <p>日時: <span id="detailTimestamp"></span></p>
        <p>支払い方法: <span id="detailPaymentMethod"></span></p>
        <p>手数料: ¥<span id="detailFeeAmount"></span></p>
        <p>純売上金額: ¥<span id="detailNetAmount"></span></p>
        <p>総原価: ¥<span id="detailTotalCost"></span></p>
        <p>総利益: ¥<span id="detailTotalProfit"></span></p>
        <!-- 返品情報 -->
        <p id="returnInfo"></p>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>商品名</th>
                <th>数量</th>
                <th>サイズ</th>
                <th>単価</th>
                <th>売上金額</th>
                <th>原価</th>
                <th>手数料</th>
                <th>利益</th>
              </tr>
            </thead>
            <tbody id="detailProductList">
              <!-- 商品詳細がここに表示されます -->
            </tbody>
          </table>
        </div>
        <button id="returnTransactionButton">返品</button>
        <button id="deleteTransactionButton">取引を削除する</button>
        <button id="closeTransactionDetails">閉じる</button>
      </div>
    </section>

    <!-- 単価設定 -->
    <section id="pricing" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>単価設定</h1>
      <!-- 単価ルール追加フォーム -->
      <form id="addPricingRuleForm">
        <select id="pricingParentCategorySelect" required>
          <option value="">親カテゴリを選択</option>
        </select>
        <select id="pricingSubcategorySelect" required>
          <option value="">サブカテゴリを選択</option>
        </select>
        <input type="number" id="minQuantity" placeholder="最小数量" required step="any" min="0" />
        <input type="number" id="maxQuantity" placeholder="最大数量" required step="any" min="0" />
        <input type="number" id="unitPrice" placeholder="単価" required step="any" min="0" />
        <button type="submit">追加</button>
      </form>
      <!-- 単価ルール一覧表示エリア -->
      <div class="table-responsive">
        <table id="pricingRulesList">
          <thead>
            <tr>
              <th>サブカテゴリ名</th>
              <th>最小数量</th>
              <th>最大数量</th>
              <th>単価</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- 単価ルール情報がここに表示されます -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- 単価ルール編集用モーダル -->
    <div id="editPricingRuleModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditPricingRuleModal">&times;</span>
        <h2>単価ルールの編集</h2>
        <form id="editPricingRuleForm">
          <input type="hidden" id="editPricingRuleId" />
          <input type="number" id="editMinQuantity" placeholder="最小数量" required step="any" min="0" />
          <input type="number" id="editMaxQuantity" placeholder="最大数量" required step="any" min="0" />
          <input type="number" id="editUnitPrice" placeholder="単価" required step="any" min="0" />
          <button type="submit">更新</button>
        </form>
      </div>
    </div>

    <!-- 支払い方法設定 -->
    <section id="payment-methods" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>支払い方法設定</h1>
      <!-- 支払い方法追加フォーム -->
      <form id="addPaymentMethodForm">
        <input type="text" id="paymentMethodName" placeholder="支払い方法名" required />
        <input type="number" id="paymentMethodFee" placeholder="手数料率(%)" required step="0.01" min="0" />
        <button type="submit">追加</button>
      </form>
      <!-- 支払い方法一覧表示エリア -->
      <div class="table-responsive">
        <table id="paymentMethodList">
          <thead>
            <tr>
              <th>支払い方法名</th>
              <th>手数料率(%)</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- 支払い方法情報がここに表示されます -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- 消耗品管理セクション -->
    <section id="consumables" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>消耗品管理</h1>
      <form id="addConsumableForm">
        <input type="text" id="consumableName" placeholder="消耗品名" required />
        <input type="number" id="consumableCost" placeholder="原価" required step="0.01" min="0" />
        <button type="submit">追加</button>
      </form>
      <div class="table-responsive">
        <table id="consumableList">
          <thead>
            <tr>
              <th>消耗品名</th>
              <th>原価</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- 消耗品情報がここに表示されます -->
          </tbody>
        </table>
      </div>

      <!-- 消耗品使用量の表示 -->
      <h2>消耗品使用量</h2>
      <div id="consumableUsageFilters">
        <label for="usageYear">年:</label>
        <select id="usageYear">
          <!-- 年の選択肢がここに表示されます -->
        </select>
        <label for="usageMonth">月:</label>
        <select id="usageMonth">
          <!-- 月の選択肢がここに表示されます -->
        </select>
        <button id="filterUsage">フィルタ</button>
      </div>
      <div class="table-responsive">
        <table id="consumableUsageList">
          <thead>
            <tr>
              <th>消耗品名</th>
              <th>使用量</th>
              <th>使用日</th>
            </tr>
          </thead>
          <tbody>
            <!-- 消耗品使用量がここに表示されます -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- 消耗品編集用モーダルを追加 -->
    <div id="editConsumableModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditConsumableModal">&times;</span>
        <h2>消耗品の編集</h2>
        <form id="editConsumableForm">
          <input type="hidden" id="editConsumableId" />
          <input type="text" id="editConsumableName" placeholder="消耗品名" required />
          <input type="number" id="editConsumableCost" placeholder="原価" required step="0.01" min="0" />
          <button type="submit">更新</button>
        </form>
      </div>
    </div>

    <!-- 消耗品使用量編集用モーダル -->
    <div id="editConsumableUsageModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeEditConsumableUsageModal">&times;</span>
        <h2>消耗品使用量の編集</h2>
        <form id="editConsumableUsageForm">
          <input type="hidden" id="editConsumableUsageId" />
          <label for="editConsumableSelect">消耗品名:</label>
          <select id="editConsumableSelect" required>
            <!-- 消耗品の選択肢がここに追加されます -->
          </select>
          <input type="number" id="editQuantityUsed" placeholder="使用量" required step="any" min="0" />
          <input type="datetime-local" id="editUsageTimestamp" required />
          <button type="submit">更新</button>
        </form>
      </div>
    </div>

 <!-- 在庫変動履歴表示用モーダルをここに追加 -->
        <div id="inventoryHistoryModal" class="modal">
          <div class="modal-content">
            <span class="close" id="closeInventoryHistoryModal">&times;</span>
            <h2>在庫変動履歴</h2>
            <table id="inventoryHistoryTable">
              <thead>
                <tr>
                  <th>日時</th>
                  <th>変動数</th>
                  <th>変更後の数量</th>
                  <th>操作したユーザー</th>
                  <th>理由</th>
                </tr>
              </thead>
              <tbody>
                <!-- 履歴データがここに表示されます -->
              </tbody>
            </table>
          </div>
        </div>

    <!-- 売上分析 -->
    <section id="sales-analysis" class="content-section" style="display: none;" data-requires-auth="true">
      <h1>売上分析</h1>
      <!-- 集計対象選択フォーム -->
      <form id="analysisPeriodForm">
        <label for="analysisPeriod">集計対象:</label>
        <select id="analysisPeriod">
          <option value="day">日別</option>
          <option value="month">月別</option>
          <option value="year">年別</option>
        </select>
        <label for="analysisYear">年:</label>
        <select id="analysisYear">
          <!-- 年のオプションが自動的に追加されます -->
        </select>
        <label for="analysisMonth">月:</label>
        <select id="analysisMonth">
          <option value="">選択してください</option>
          <option value="1">1月</option>
          <option value="2">2月</option>
          <option value="3">3月</option>
          <option value="4">4月</option>
          <option value="5">5月</option>
          <option value="6">6月</option>
          <option value="7">7月</option>
          <option value="8">8月</option>
          <option value="9">9月</option>
          <option value="10">10月</option>
          <option value="11">11月</option>
          <option value="12">12月</option>
        </select>
        <button type="submit">表示する</button>
      </form>
      <!-- 売上分析集計テーブル -->
      <div class="table-responsive">
        <table id="salesSummaryTable">
          <thead>
            <tr>
              <th rowspan="2">集計期間</th>
              <th rowspan="2">売上</th>
              <th rowspan="2">原価</th>
              <th rowspan="2">利益</th>
              <th rowspan="2">会計数</th>
              <th rowspan="2">客単価</th>
              <th rowspan="2">商品数</th>
              <th colspan="2">支払方法別売上</th>
              <th rowspan="2">割引額</th>
              <th rowspan="2">詳細</th>
            </tr>
            <tr>
              <th>現金</th>
              <th>その他</th>
            </tr>
          </thead>
          <tbody>
            <!-- 売上集計データがここに表示されます -->
          </tbody>
        </table>
      </div>
      <!-- 売上分析グラフ表示エリア -->
      <canvas id="salesChart"></canvas>
    </section>
  </main>

  <!-- QuaggaJS ライブラリの読み込み -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

  <!-- JavaScript ファイルの読み込み -->
  <script type="module" src="main.js"></script>

  <!-- 年のオプションを追加するスクリプト -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const yearSelect = document.getElementById('analysisYear');
      const currentYear = new Date().getFullYear();
      for (let year = 2015; year <= currentYear; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = `${year}年`;
        yearSelect.appendChild(option);
      }
    });
  </script>
</body>
</html>
